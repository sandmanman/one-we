<template>
    <div class="g-bd3 g-bd3-1 f-cb">
        <!-- menu S -->
        <div class="g-sd3 g-sd3-l">
            <div class="n-minelst n-minelst-2">
                <h2 class="f-ff1">云音乐特色榜</h2>
                <ul class="f-cb">
                    <li class="mine selected">
                        <a href="/discover/toplist?id=3" class="item f-cb">
                            <div class="left">
                                <span class="avatar">
                                    <img src="http://p1.music.126.net/DrRIg6CrgDfVLEph9SNh7w==/18696095720518497.jpg?param=40y40" alt="云音乐飙升榜">
                                    <span class="msk"></span>
                                </span>
                            </div>
                            <p class="name"><span class="s-fc0">云音乐飙升榜</span></p>
                            <p class="s-fc4">每天更新</p>
                        </a>
                    </li>
                    <li class="mine">
                        <a href="/discover/toplist?id=0" class="item f-cb">
                            <div class="left">
                                <span class="avatar">
                                    <img src="http://p1.music.126.net/N2HO5xfYEqyQ8q6oxCw8IQ==/18713687906568048.jpg?param=40y40" alt="云音乐新歌榜">
                                    <span class="msk"></span>
                                </span>
                            </div>
                            <p class="name"><span class="s-fc0">云音乐新歌榜</span></p>
                            <p class="s-fc4">每天更新</p>
                        </a>
                    </li>
                    <li class="mine">
                        <a href="/discover/toplist?id=2" class="item f-cb">
                            <div class="left">
                                <span class="avatar">
                                    <img src="http://p1.music.126.net/sBzD11nforcuh1jdLSgX7g==/18740076185638788.jpg?param=40y40" alt="网易原创歌曲榜">
                                    <span class="msk"></span>
                                </span>
                            </div>
                            <p class="name"><span class="s-fc0">网易原创歌曲榜</span></p>
                            <p class="s-fc4">每周四更新</p>
                        </a>
                    </li>
                    <li class="mine">
                        <a href="/discover/toplist?id=1" class="item f-cb">
                            <div class="left">
                                <span class="avatar">
                                    <img src="http://p1.music.126.net/GhhuF6Ep5Tq9IEvLsyCN7w==/18708190348409091.jpg?param=40y40" alt="云音乐热歌榜">
                                    <span class="msk"></span>
                                </span>
                            </div>
                            <p class="name"><span class="s-fc0">云音乐热歌榜</span></p>
                            <p class="s-fc4">每周四更新</p>
                        </a>
                    </li>
                </ul>

                <h2 class="scd f-ff1">全球媒体榜</h2>
                <ul class="f-cb">
                    <li class="mine">
                        <a href="/discover/toplist?id=4" class="item f-cb">
                            <div class="left">
                                <span class="avatar">
                                    <img src="http://p1.music.126.net/4mh2HWH-bd5sRufQb-61bg==/3302932937414659.jpg?param=40y40" alt="云音乐电音榜">
                                    <span class="msk"></span>
                                </span>
                            </div>
                            <p class="name"><span class="s-fc0">云音乐电音榜</span></p>
                            <p class="s-fc4">每周五更新</p>
                        </a>
                    </li>
                    <li class="mine">
                        <a href="/discover/toplist?id=5" class="item f-cb">
                            <div class="left">
                                <span class="avatar">
                                    <img src="http://p1.music.126.net/VQOMRRix9_omZbg4t-pVpw==/18930291695438269.jpg?param=40y40" alt="UK排行榜周榜">
                                    <span class="msk"></span>
                                </span>
                            </div>
                            <p class="name"><span class="s-fc0">UK排行榜周榜</span></p>
                            <p class="s-fc4">每周一更新</p>
                        </a>
                    </li>
                    <li class="mine">
                        <a href="/discover/toplist?id=6" class="item f-cb">
                            <div class="left">
                                <span class="avatar">
                                    <img src="http://p1.music.126.net/EBRqPmY8k8qyVHyF8AyjdQ==/18641120139148117.jpg?param=40y40" alt="美国Billboard周榜">
                                    <span class="msk"></span>
                                </span>
                            </div>
                            <p class="name"><span class="s-fc0">美国Billboard周榜</span></p>
                            <p class="s-fc4">每周三更新</p>
                        </a>
                    </li>
                    <li class="mine">
                        <a href="/discover/toplist?id=21" class="item f-cb">
                            <div class="left">
                                <span class="avatar">
                                    <img src="http://p1.music.126.net/A61n94BjWAb-ql4xpwpYcg==/18613632348448741.jpg?param=40y40" alt="Beatport全球电子舞曲榜">
                                    <span class="msk"></span>
                                </span>
                            </div>
                            <p class="name"><span class="s-fc0">Beatport全球电子舞曲榜</span></p>
                            <p class="s-fc4">每周四更新</p>
                        </a>
                    </li>
                    <li class="mine">
                        <a href="/discover/toplist?id=19" class="item f-cb">
                            <div class="left">
                                <span class="avatar">
                                    <img src="http://p1.music.126.net/6O0ZEnO-I_RADBylVypprg==/109951162873641556.jpg?param=40y40" alt="法国 NRJ Vos Hits 周榜">
                                    <span class="msk"></span>
                                </span>
                            </div>
                            <p class="name"><span class="s-fc0">法国 NRJ Vos Hits 周榜</span></p>
                            <p class="s-fc4">每周五更新</p>
                        </a>
                    </li>
                    <li class="mine">
                        <a href="/discover/toplist?id=7" class="item f-cb">
                            <div class="left">
                                <span class="avatar">
                                    <img src="http://p1.music.126.net/H4Y7jxd_zwygcAmPMfwJnQ==/19174383276805159.jpg?param=40y40" alt="KTV唛榜">
                                    <span class="msk"></span>
                                </span>
                            </div>
                            <p class="name"><span class="s-fc0">KTV唛榜</span></p>
                            <p class="s-fc4">每周五更新</p>
                        </a>
                    </li>
                    <li class="mine">
                        <a href="/discover/toplist?id=8" class="item f-cb">
                            <div class="left">
                                <span class="avatar">
                                    <img src="http://p1.music.126.net/83pU_bx5Cz0NlcTq-P3R3g==/18588343581028558.jpg?param=40y40" alt="iTunes榜">
                                    <span class="msk"></span>
                                </span>
                            </div>
                            <p class="name"><span class="s-fc0">iTunes榜</span></p>
                            <p class="s-fc4">每周一更新</p>
                        </a>
                    </li>
                    <li class="mine">
                        <a href="/discover/toplist?id=10" class="item f-cb">
                            <div class="left">
                                <span class="avatar">
                                    <img src="http://p1.music.126.net/Rgqbqsf4b3gNOzZKxOMxuw==/19029247741938160.jpg?param=40y40" alt="日本Oricon周榜">
                                    <span class="msk"></span>
                                </span>
                            </div>
                            <p class="name"><span href="/discover/toplist?id=10" class="s-fc0">日本Oricon周榜</span></p>
                            <p class="s-fc4">每周三更新</p>
                        </a>
                    </li>
                    <li class="mine">
                        <a href="/discover/toplist?id=9" class="item f-cb">
                            <div class="left">
                                <span class="avatar">
                                    <img src="http://p1.music.126.net/54vZEZ-fCudWZm6GH7I55w==/19187577416338508.jpg?param=40y40" alt="Hit FM Top榜">
                                    <span class="msk"></span>
                                </span>
                            </div>
                            <p class="name"><span class="s-fc0">Hit FM Top榜</span></p>
                            <p class="s-fc4">每周一更新</p>
                        </a>
                    </li>
                    <li class="mine">
                        <a href="/discover/toplist?id=20" class="item f-cb">
                            <div class="left">
                                <span class="avatar">
                                    <img src="http://p1.music.126.net/wqi4TF4ILiTUUL5T7zhwsQ==/18646617697286899.jpg?param=40y40" alt="台湾Hito排行榜">
                                    <span class="msk"></span>
                                </span>
                            </div>
                            <p class="name"><span class="s-fc0">台湾Hito排行榜</span></p>
                            <p class="s-fc4">每周一更新</p>
                        </a>
                    </li>
                    <li class="mine">
                        <a href="/discover/toplist?id=14" class="item f-cb">
                            <div class="left">
                                <span class="avatar">
                                    <img src="http://p1.music.126.net/JPh-zekmt0sW2Z3TZMsGzA==/18967675090783713.jpg?param=40y40" alt="中国TOP排行榜（港台榜）">
                                    <span class="msk"></span>
                                </span>
                            </div>
                            <p class="name"><span class="s-fc0">中国TOP排行榜（港台榜）</span></p>
                            <p class="s-fc4">每周一更新</p>
                        </a>
                    </li>
                    <li class="mine">
                        <a href="/discover/toplist?id=15" class="item f-cb">
                            <div class="left">
                                <span class="avatar">
                                    <img src="http://p1.music.126.net/2klOtThpDQ0CMhOy5AOzSg==/18878614648932971.jpg?param=40y40" alt="中国TOP排行榜（内地榜）">
                                    <span class="msk"></span>
                                </span>
                            </div>
                            <p class="name"><span class="s-fc0">中国TOP排行榜（内地榜）</span></p>
                            <p class="s-fc4">每周一更新</p>
                        </a>
                    </li>
                    <li href="/discover/toplist?id=16" class="mine">
                        <a class="item f-cb">
                            <div class="left">
                                <span class="avatar">
                                    <img src="http://p1.music.126.net/YQsr07nkdkOyZrlAkf0SHA==/18976471183805915.jpg?param=40y40" alt="香港电台中文歌曲龙虎榜">
                                    <span class="msk"></span>
                                </span>
                            </div>
                            <p class="name"><span class="s-fc0">香港电台中文歌曲龙虎榜</span></p>
                            <p class="s-fc4">每周五更新</p>
                        </a>
                    </li>
                    <li class="mine">
                        <a href="/discover/toplist?id=18" class="item f-cb">
                            <div class="left">
                                <span class="avatar">
                                    <img src="http://p1.music.126.net/_nwkQTFtOdAjFvOI8Wg7Tg==/18922595114302109.jpg?param=40y40" alt="中国嘻哈榜">
                                    <span class="msk"></span>
                                </span>
                            </div>
                            <p class="name"><span class="s-fc0">中国嘻哈榜</span></p>
                            <p class="s-fc4">每周五更新</p>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <!-- menu End -->


        <div class="g-mn3">
            <div class="g-mn3c">
                <!-- header -->
                <div class="g-wrap">
                    <div class="m-info m-info-rank f-cb">
                        <div class="cover u-cover u-cover-rank">
                            <img :src="toplist.coverImgUrl+'?param=150y150'">
                            <span class="msk"></span>
                        </div>
                        <div class="cnt">
                            <div class="cntc m-info">
                                <div class="hd f-cb">
                                    <h2 class="f-ff2">{{toplist.name}}</h2>
                                </div>
                                <div class="user f-cb">
                                    <i class="u-icn u-icn-57"></i>
                                    <span class="sep s-fc3">最近更新：{{toplist.trackUpdateTime | formatToplistUpdateDate}}</span>
                                    <span class="s-fc4">（每天更新）</span>
                                </div>
                                <div class="btns f-cb">
                                    <a href="javascript:;" class="u-btn2 u-btn2-2 u-btni-addply f-fl">
                                        <i><em class="ply"></em>播放</i>
                                    </a>
                                    <a href="javascript:;" class="u-btni u-btni-add" title="添加到播放列表"></a>
                                    <a class="u-btni u-btni-fav" href="javascript:;"><i>({{toplist.subscribedCount}})</i></a>
                                    <a class="u-btni u-btni-share" href="javascript:;"><i>({{toplist.shareCount}})</i></a>
                                    <a class="u-btni u-btni-dl" href="javascript:;"><i>下载</i></a>
                                    <a href="javascript:;" class="u-btni u-btni-cmmt j-cmt">
                                        <i>(<span>{{toplist.commentCount}}</span>)</i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="g-wrap12">
                    <!-- 歌曲列表 S -->
                    <div class="u-title u-title-1 f-cb">
                        <h3><span class="f-ff2">歌曲列表</span></h3>
                        <span class="sub s-fc3"><span>{{toplist.trackCount}}</span>首歌</span>
                        <div class="more s-fc3">播放：<strong class="s-fc6">{{toplist.playCount}}</strong>次</div>
                    </div>
                    <div id="song-list-pre-cache">
                        <div class="j-flag">
                            <table class="m-table m-table-rank">
                                <thead>
                                    <tr>
                                        <th class="first w1"></th>
                                        <th><div class="wp">标题</div></th>
                                        <th class="w2-1"><div class="wp">时长</div></th>
                                        <th class="w3"><div class="wp">歌手</div></th>
                                    </tr>
                                </thead>
                                <tbody>

                                    <tr v-for="(item, index) in top3" :key="item.id">
                                        <td>
                                            <div class="hd">
                                                <span class="num">{{index+1}}</span>
                                                <div class="rk ">
                                                    <span class="ico u-icn u-icn-73 s-fc9">5</span>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="rank">
                                            <div class="f-cb">
                                                <div class="tt">
                                                    <a :href="'/song?id='+item.id">
                                                        <img class="rpic" :src="item.album.picUrl+'?param=50y50&amp;quality=100'">
                                                    </a>
                                                    <span class="ply ">&nbsp;</span>
                                                    <div class="ttc">
                                                        <span class="txt">
                                                            <a :href="'/song?id='+item.id">
                                                                <b :title="item.name + '- ('+ item.alias[0] +')'">{{item.name}}</b>
                                                            </a>
                                                            <span v-if="item.alias[0]" :title="item.alias[0]" class="s-fc8">
                                                                - {{item.alias[0]}}
                                                            </span>
                                                            <span title="播放mv" class="mv">MV</span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class=" s-fc3">
                                            <span class="u-dur ">{{item.duration | formatMusicDuration}}</span>
                                            <div class="opt hshow">
                                                <a class="u-icn u-icn-81 icn-add" href="javascript:;" title="添加到播放列表"></a>
                                                <span class="icn icn-fav" title="收藏"></span>
                                                <span class="icn icn-share" title="分享">分享</span>
                                                <span class="icn icn-dl" title="下载"></span>
                                            </div>
                                        </td>
                                        <td class="">
                                            <div class="text">
                                                <span v-for="(name, index) in item.artists" :key="index" :title="name.name">
                                                    <a class="" :href="'/artist?id='+name.id">{{name.name}}</a>
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <!-- / tr -->


                                    <tr v-for="(item, index) in topOther" :key="index">
                                        <td>
                                            <div class="hd">
                                                <span class="num">{{index+4}}</span>
                                                <div class="rk ">
                                                    <span class="u-icn u-icn-75"></span>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="">
                                            <div class="f-cb">
                                                <div class="tt">
                                                    <span class="ply ">&nbsp;</span>
                                                    <div class="ttc">
                                                        <span class="txt">
                                                            <a :href="'/song?id='+item.id">
                                                                <b :title="item.name + '- ('+ item.alias[0] +')'">{{item.name}}</b>
                                                            </a>
                                                            <span v-if="item.alias[0]" :title="item.alias[0]" class="s-fc8">
                                                                - {{item.alias[0]}}
                                                            </span>
                                                            <span title="播放mv" class="mv" v-if="item.mvid !== 0">MV</span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class=" s-fc3">
                                            <span class="u-dur ">{{item.duration | formatMusicDuration}}</span>
                                            <div class="opt hshow">
                                                <a class="u-icn u-icn-81 icn-add" href="javascript:;" title="添加到播放列表"></a>
                                                <span class="icn icn-fav" title="收藏"></span>
                                                <span class="icn icn-share" title="分享">分享</span>
                                                <span class="icn icn-dl" title="下载"></span>
                                            </div>
                                        </td>
                                        <td class="">
                                            <div class="text">
                                                <span v-for="(name, index) in item.artists" :key="index" :title="name.name">
                                                    <a class="" :href="'/artist?id='+name.id">{{name.name}}</a>
                                                </span>
                                            </div>
                                        </td>
                                    </tr>



                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- 歌曲列表 End -->

                    <!-- 评论 S -->
                    <div class="n-cmt">
                        <div class="u-title u-title-1">
                            <h3><span class="f-ff2">评论</span></h3>
                            <span class="sub s-fc3">共<span class="j-flag">{{toplist.commentCount}}</span>条评论</span>
                        </div>
                        <div class="m-cmmt">
                            <!-- 输入评论 S -->
                            <div class="iptarea">
                                <div class="head">
                                    <img src="http://s4.music.126.net/style/web2/img/default/default_avatar.jpg?param=50y50">
                                </div>
                                <div class="j-flag">
                                    <div>
                                        <div class="m-cmmtipt f-cb f-pr">
                                            <div class="u-txtwrap holder-parent f-pr" style="display: block;">
                                                <textarea class="u-txt area j-flag" placeholder="评论"></textarea>
                                            </div>
                                            <div class="btns f-cb f-pr">
                                                <i class="icn u-icn u-icn-36 j-flag"></i>
                                                <i class="icn u-icn u-icn-41 j-flag"></i>
                                                <a href="javascript:void(0)" class="btn u-btn u-btn-1 j-flag">评论</a>
                                                <span class="zs s-fc4 j-flag">140</span>
                                            </div>
                                            <div class="corr u-arr">
                                                <em class="arrline">◆</em><span class="arrclr">◆</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 输入评论 End -->

                            <div class="cmmts j-flag">
                                <template v-if="this.hotComments.length !== 0">
                                <!-- 精彩评论 S -->
                                <h3 class="u-hd4">精彩评论</h3>
                                <div class="itm" v-for="item in hotComments" :key="item.commentId">
                                    <div class="head">
                                        <a :href="'/user/home?id='+item.user.userId">
                                            <img :src="item.user.avatarUrl+'?param=50y50'">
                                        </a>
                                    </div>
                                    <div class="cntwrap">
                                        <div class="">
                                            <div class="cnt f-brk">
                                                <a :href="'/user/home?id='+item.user.userId" class="s-fc7">{{item.user.nickname}}</a>：
                                                {{item.content}}
                                            </div>
                                        </div>
                                        <div class="rp">
                                            <div class="time s-fc4">{{item.time | formatCommentTime}}</div>
                                            <a href="javascript:void(0)"><i class="zan u-icn2 u-icn2-12"></i> ({{item.likedCount}})</a>
                                            <span class="sep">|</span>
                                            <a href="javascript:void(0)" class="s-fc3">回复</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- / .itm -->
                                <!-- 精彩评论 End -->
                                <br>
                                <br>
                                </template>


                                <h3 class="u-hd4">最新评论({{toplist.commentCount}})</h3>
                                <div class="itm" v-for="item in comments" :key="item.commentId">
                                    <div class="head">
                                        <a href="/user/home?id=402266706">
                                            <img :src="item.user.avatarUrl+'?param=50y50'">
                                        </a>
                                    </div>
                                    <div class="cntwrap">
                                        <div class="">
                                            <div class="cnt f-brk">
                                                <a :href="'/user/home?id='+item.user.userId" class="s-fc7">{{item.user.nickname}}</a>：
                                                {{item.content}}
                                            </div>
                                        </div>
                                        <template v-if="item.beReplied">
                                            <div class="que f-brk f-pr s-fc3" v-for="(reply, index) in item.beReplied" :key="index">
                                                <span class="darr">
                                                    <i class="bd">◆</i>
                                                    <i class="bg">◆</i>
                                                </span>
                                                <a :href="'/user/home?id='+reply.user.userId" class="s-fc7">
                                                {{reply.user.nickname}}</a>：
                                                {{reply.content}}
                                            </div>
                                        </template>
                                        <div class="rp">
                                            <div class="time s-fc4">{{item.time | formatCommentTime}}</div>
                                            <a href="javascript:void(0)"><i class="zan u-icn2 u-icn2-12"></i> ({{item.likedCount}})</a>
                                            <span class="sep">|</span>
                                            <a href="javascript:void(0)" class="s-fc3">回复</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- / .itm -->
                            </div>
                            <!-- / .cmmts -->
                        </div>
                        <!-- / .m-cmmt -->
                    </div>
                    <!-- 评论 End -->
                    
                    <!-- 分页 S -->
                    <div class="j-flag">
                        <div class="u-page">
                            <a href="#" class="zbtn zprv js-p-1503235651126 js-disabled">上一页</a>
                            <a href="#" class="zpgi zpg1 js-i-1503235651126 js-selected">1</a>
                            <a href="#" class="zpgi zpg2 js-i-1503235651126">2</a>
                            <a href="#" class="zpgi zpg3 js-i-1503235651126">3</a>
                            <a href="#" class="zpgi zpg4 js-i-1503235651126">4</a>
                            <a href="#" class="zpgi zpg5 js-i-1503235651126">5</a>
                            <a href="#" class="zpgi zpg6 js-i-1503235651126">6</a>
                            <a href="#" class="zpgi zpg7 js-i-1503235651126">7</a>
                            <a href="#" class="zpgi zpg8 js-i-1503235651126">8</a>
                            <span class="zdot">...</span>
                            <a href="#" class="zpgi zpg9 js-i-1503235651126">3697</a>
                            <a href="#" class="zbtn znxt js-n-1503235651126">下一页</a>
                        </div>
                    </div>
                    <!-- 分页 End -->


                </div>

            </div>

        </div>
    </div>
</template>

<script>
import { toplist, commentToplist } from '@/api'
import { formatDate, formatSeconds} from '@/utils'
export default {
    name: 'Toplist',
    data() {
        return {
            toplistID: null,
            toplist: null,
            top3: null,
            topOther: null,
            toplistCommentId: null,
            hotComments: null,
            comments: null,
        }
    },
    created() {
        // get url params
        var getUrlParams = function() {
            var queryString = {}
            var query = window.location.search.substring(1)
            var vars = query.split('&')
            for (var i=0;i<vars.length;i++) {
                var pair = vars[i].split('=')
                if (typeof queryString[pair[0]] === 'undefined') {
                    queryString[pair[0]] = decodeURIComponent(pair[1])
                } else if (typeof queryString[pair[0]] === 'string') {
                    var arr = [ queryString[pair[0]],decodeURIComponent(pair[1]) ]
                    queryString[pair[0]] = arr
                } else {
                    queryString[pair[0]].push(decodeURIComponent(pair[1]))
                }
            }
            return queryString
        }();
        console.log('route parmas id:'+getUrlParams.id)
        if ( getUrlParams.id ) {
            this.toplistID = getUrlParams.id
        } else {
            this.toplistID = 3
        }
        this.getToplist(this.toplistID)
    },
    methods: {
        getToplist(toplistID) {
            toplist(toplistID).then(res => {
                if( res.data.code === 200 ) {
                    this.toplist = res.data.result
                    this.top3 = res.data.result && res.data.result.tracks.slice(0,3)
                    this.topOther = res.data.result && res.data.result.tracks.slice(3)

                    var commentId = res.data.result.commentThreadId.replace(/A_PL_0_/g, '')
                    this.toplistCommentId = commentId

                    // 请求该排行榜下的评论
                    this.getComment(this.toplistCommentId)
                } else {
                    console.error('数据获取错误')
                }
                
            }).catch(error => {
                console.log(error)
            })
        },
        getComment(id) {
            commentToplist(id).then(res => {
                if( res.data.code === 200 ) {
                    this.hotComments = res.data.hotComments
                    this.comments = res.data.comments
                } else {
                    console.error('数据获取错误')
                }
            }).catch(error => {
                console.log(error)
            })
        }
    },
    filters: {
        formatToplistUpdateDate(date) { // 排行榜更新日期格式
            return formatDate.mmdd(date)
        },
        formatMusicDuration(val) { // 音乐播放总时长格式
            return formatSeconds(val)
        },
        formatCommentTime(date) { // 评论时间格式
            return formatDate.fullDate(date)
        }
    }
}
</script>

<style>

</style>